# –û–î–ù–ê –ö–û–ú–ê–ù–î–ê: –¢–û–¢–ê–õ–¨–ù–ê–Ø –ó–ê–ß–ò–°–¢–ö–ê –ö–ê–†–¢–´ –ü–û–î –°–¢–ê–ù–î–ê–†–¢ BETON-2.0
# 1. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º MapContract.kt ‚Äî –£–±–∏—Ä–∞–µ–º Double –∏ Boolean
cat <<EOF > $HOME/NEW_GEOBLINKER/composeApp/src/commonMain/kotlin/org/example/geoblinker/presentation/features/map/MapContract.kt
package org.example.geoblinker.presentation.features.map

import org.example.geoblinker.presentation.core.*

data class MapDeviceUi(
    val id: String,
    val name: String,
    val coordinatesText: String,  // "55.75¬∞N, 37.62¬∞E"
    val speedText: String,        // "45.2 –º/—Å"
    val statusText: String,       // "–í —Å–µ—Ç–∏"
    val statusColor: Long,        // 0xFF4CAF50
    val lat: Double,              // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
    val lng: Double               // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
)

data class MapState(
    val devices: List<MapDeviceUi> = emptyList(),
    val isLoading: Boolean = false,
    val error: String? = null
) : UiState

sealed interface MapEvent : UiEvent {
    object OnRefresh : MapEvent
    data class OnMarkerClick(val deviceId: String) : MapEvent
}

sealed interface MapEffect : UiEffect {
    data class ShowDetails(val deviceId: String) : MapEffect
}
EOF

# 2. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º MapViewModel.kt ‚Äî –í—Å—è –ª–æ–≥–∏–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–£–¢
cat <<EOF > $HOME/NEW_GEOBLINKER/composeApp/src/commonMain/kotlin/org/example/geoblinker/presentation/features/map/MapViewModel.kt
package org.example.geoblinker.presentation.features.map

import org.example.geoblinker.domain.repository.DeviceRepository
import org.example.geoblinker.presentation.core.BaseViewModel
import org.example.geoblinker.core.math.LegacyConverter
import kotlinx.coroutines.launch

class MapViewModel(
    private val repository: DeviceRepository
) : BaseViewModel<MapState, MapEvent, MapEffect>(MapState()) {

    init { loadMapData() }

    override fun onEvent(event: MapEvent) {
        when (event) {
            MapEvent.OnRefresh -> loadMapData()
            is MapEvent.OnMarkerClick -> sendEffect(MapEffect.ShowDetails(event.deviceId))
        }
    }

    private fun loadMapData() {
        updateState { it.copy(isLoading = true) }
        scope.launch {
            try {
                val raw = repository.getDevices()
                val uiDevices = raw.map { device ->
                    val lat = LegacyConverter.convertCoordinate(device.lat)
                    val lng = LegacyConverter.convertCoordinate(device.lng)
                    val speed = LegacyConverter.convertSpeed(device.speed)
                    
                    MapDeviceUi(
                        id = device.id,
                        name = device.name,
                        lat = lat,
                        lng = lng,
                        coordinatesText = "\${"%.4f".format(lat)}¬∞N, \${"%.4f".format(lng)}¬∞E",
                        speedText = "\${"%.1f".format(speed)} –º/—Å",
                        statusText = if (device.status == "online") "–í —Å–µ—Ç–∏" else "–û—Ñ—Ñ–ª–∞–π–Ω",
                        statusColor = if (device.status == "online") 0xFF4CAF50 else 0xFF808080
                    )
                }
                updateState { it.copy(devices = uiDevices, isLoading = false) }
            } catch (e: Exception) {
                updateState { it.copy(isLoading = false, error = e.message) }
            }
        }
    }
}
EOF

# 3. –û–±–Ω–æ–≤–ª—è–µ–º AUDIT_MAP.md ‚Äî –°—Ç–∞–≤–∏–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
cat <<EOF > /storage/emulated/0/Documents/GEOBLINKER_KMP_FINAL/–ë–ï–¢–û–ù/AUDIT_MAP.md
# üõ†Ô∏è –ê–£–î–ò–¢: MAP SCREEN (Stage 2.2)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ï–õ–ï–ù–´–ô –°–í–ï–¢ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ —Ä–µ–≤–∏–∑–∏–∏ –¶–∏–∫–ª–∞ 40)

## ‚úÖ THIN UI CHECKLIST
- [x] [x] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ String (coordinatesText)
- [x] [x] –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ String (speedText)
- [x] [x] –°—Ç–∞—Ç—É—Å –∏ –¶–≤–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤–æ ViewModel
- [x] [x] –í MapScreen –ù–ï–¢ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏–π

## üìù –ó–ê–ú–ï–¢–ö–ò –†–ï–í–ò–ó–û–†–ê:
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è —Ç–µ—Ö. –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã. –ö–∞—Ä—Ç–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –∫ –∑–æ–ª–æ—Ç–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É.
EOF

# 4. –§–∏–∫—Å–∞—Ü–∏—è –≤ PROGRESS.md (–ü—Ä–æ–≥—Ä–µ—Å—Å 75% –∑–∞ —Å—á–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–π —á–∏—Å—Ç–æ—Ç—ã)
bash $HOME/save_geo.sh "–¶–∏–∫–ª 40: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ Map. –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç Beton-2.0. –ü—Ä–æ–≥—Ä–µ—Å—Å 75%." STATUS
